{{ define "main" }}
{{- $type := .Params.post_type | default "post" -}}

<article class="single-post post-{{ $type }}" data-pagefind-body>
  {{- if eq $type "quote" -}}
  {{/* Quote Post - No title */}}
  <div class="post-content">
    {{ .Content }}
  </div>
  {{ with .Params.attribution }}
  <p class="quote-attribution">— {{ . }}</p>
  {{ end }}

  {{- else if eq $type "link" -}}
  {{/* Link Post */}}
  <header class="post-header">
    <h1 class="post-title">
      <a href="{{ .Params.link_url }}" target="_blank" rel="noopener">{{ .Title }}{{ partial "star.html" . }}</a>
    </h1>
  </header>
  {{ with .Content }}
  <div class="post-content">
    {{ . }}
  </div>
  {{ end }}

  {{- else if eq $type "photo" -}}
  {{/* Photo Post */}}
  <figure class="post-photo-full">
    <img src="{{ .Params.photo_url }}" alt="{{ .Title }}">
  </figure>
  <header class="post-header">
    <h1 class="post-title">{{ .Title }}{{ partial "star.html" . }}</h1>
  </header>
  {{ with .Content }}
  <div class="post-content">
    {{ . }}
  </div>
  {{ end }}

  {{- else if eq $type "album" -}}
  {{/* Album Review */}}
  <header class="post-header">
    <h1 class="post-title">{{ .Params.artist }} – {{ .Params.album }} ({{ .Params.year }}){{ partial "star.html" . }}{{ partial "rating.html" . }}</h1>
  </header>
  {{ with .Params.cover_url }}
  <figure class="review-cover">
    <img src="{{ . }}" alt="{{ $.Params.album }} cover">
    <figcaption>{{ with $.Params.cover_caption }}{{ . }}{{ else }}{{ $.Params.album }} ({{ $.Params.year }}){{ end }}</figcaption>
  </figure>
  {{ end }}
  {{ with .Content }}
  <div class="post-content">
    {{ . }}
  </div>
  {{ end }}

  {{- else if eq $type "movie" -}}
  {{/* Movie Review */}}
  <header class="post-header">
    <h1 class="post-title">{{ .Title }} ({{ .Params.year }}){{ partial "star.html" . }}{{ partial "rating.html" . }}</h1>
  </header>
  {{ with .Params.poster_url }}
  <figure class="review-cover">
    <img src="{{ . }}" alt="{{ $.Title }} poster">
    <figcaption>{{ with $.Params.cover_caption }}{{ . }}{{ else }}{{ $.Title }} ({{ $.Params.year }}){{ end }}</figcaption>
  </figure>
  {{ end }}
  {{ with .Content }}
  <div class="post-content">
    {{ . }}
  </div>
  {{ end }}

  {{- else if eq $type "book" -}}
  {{/* Book Review */}}
  <header class="post-header">
    <h1 class="post-title">{{ .Params.author }} – {{ .Title }} ({{ .Params.year }}){{ partial "star.html" . }}{{ partial "rating.html" . }}</h1>
  </header>
  {{ with .Params.cover_url }}
  <figure class="review-cover">
    <img src="{{ . }}" alt="{{ $.Title }} cover">
    <figcaption>{{ with $.Params.cover_caption }}{{ . }}{{ else }}{{ $.Params.author }}, {{ $.Params.year }}{{ end }}</figcaption>
  </figure>
  {{ end }}
  {{ with .Content }}
  <div class="post-content">
    {{ . }}
  </div>
  {{ end }}

  {{- else -}}
  {{/* Regular Post */}}
  <header class="post-header">
    <h1 class="post-title">{{ .Title }}{{ partial "star.html" . }}</h1>
  </header>
  {{ with .Content }}
  <div class="post-content">
    {{ . }}
  </div>
  {{ end }}

  {{- end -}}

  {{/* Post Meta */}}
  <footer class="post-meta">
    <time class="post-date" datetime="{{ .Date.Format "2006-01-02" }}">
      <a href="{{ .RelPermalink }}">{{ .Date.Format "2006-01-02" }}</a>
    </time>
    {{ partial "reading-time.html" . }}
    {{ with .Params.tags }}
    <div class="post-tags">
      {{- range . -}}
      <a href="/tags/{{ . | urlize }}/">{{ . }}</a>
      {{- end -}}
    </div>
    {{ end }}
  </footer>
</article>

{{/* Backlinks */}}
{{ partial "backlinks.html" . }}

{{/* Similar Posts - only for blog posts */}}
{{ partial "similar-posts.html" . }}

{{ end }}
